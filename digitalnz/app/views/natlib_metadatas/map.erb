<% content_for :header do%>
<%= render :partial => 'archive_searches/search_form_small' %>
<%end%>

<% content_for :col1 do %>
<div class="content">
    <%if !@natlib_metadata.thumbnail_url.blank?%>
    <a href="<%=@natlib_metadata.landing_url%>"><img style="float:right;" src="<%=@natlib_metadata.thumbnail_url%>" /></a><%end%>
    <h1><%=@natlib_metadata.title%></h1>
<div class="metadataDescription">
<%=@natlib_metadata.description%>
</div>

<%if !@submission.blank?%>

        <%if !@map.blank?%>
         <%= @map.div(:width => 600, :height => 300) %>
        <%else%>
        No map available
        <%end%>
<div id="geonameFrequencies">
		<%for words in @phrases
			freak = @phrase_frequencies[words]
			tooltip = "#{freak} occurences found in source text"
			
			the_size = 7+1.5*freak.to_f
			non_geo_string = ''
			if @accuracies[words].blank?
				non_geo_string = ' nongeo'
				tooltip << "\nNo location found"
			else
				tooltip << "\nLocation found"
			end
		%>
		<span class="geonameFrequency<%=non_geo_string%>" style="font-size: <%=the_size%>pt;" title="<%=tooltip%>"><%=words%></span>
		<%
		end%>
</div>
</div>
<%end%>

<div class="extractedText">
	<h2>Extracted Metadata Text</h2>
	<p>The following text was collated from the metadata and used for geoparsing:</p>
	<div class="metatext">
	<%for para in @natlib_metadata.geo_text(true)%>
	<p><%=para%></p>
	<%end%>
	</div>

</div>
<%end%>



<% content_for :col2 do %>
	<div id="natlibRecordInformation">
		
	<h3>Digital NZ Metadata</h3>
	<h4>Record Number</h4>
	<ul>
	<li><%=@natlib_metadata.natlib_id%></li>
	</ul>
	<h4>Content Partner</h4>
	<ul>
	<%for content_partner in @natlib_metadata.content_partners%>
	<li><%=content_partner.name %></li>
	<%end%>
	</ul>
	<h4>Collection</h4>
	<ul>
		<%for collection in @natlib_metadata.collections%>
			<li><%=collection.name%></li>
		<%end%>
	</ul>

	<%if !@natlib_metadata.coverages.blank?%>
	<h4>Coverages</h4>
	<ul>
	<%for item in @natlib_metadata.coverages%>
	<li><%=item.name%></li>
	<%end%>
	</ul>
	<%end%>

	<%if !@natlib_metadata.subjects.blank?%>
	<h4>Subjects</h4>
	<ul>
	<%for item in @natlib_metadata.subjects%>
	<li><%=item.name%></li>
	<%end%>
	</ul>
	<%end%>

	<%if !@natlib_metadata.placenames.blank?%>
	<h4>Placenames</h4>
	<ul>
	<%for item in @natlib_metadata.placenames%>
	<li><%=item.name%></li>
	<%end%>
	</ul>
	<%end%>
	
	
	<h3>Places Found</h3>
	<%for acc in @all_accuracies
		if !@inverted_accuracies[acc.name].blank?
	%>
		<h4><%=acc.name%></h4>
		<ul>
			<%for geoname in @accuracies.keys
			if @accuracies[geoname] == acc.name
				freak = @phrase_frequencies[geoname]
				freak_string = ""
				freak_string = " (#{freak})" if !freak.blank?
			%>
			<li><%=geoname%></li>
			<%
			end
			end%>
		</ul>
	<%
		end
	end
	%>
	
	<h3>Area</h3>
	<ul><li><%=SubmissionsHelper.pretty_area(@submission.area)%></li></ul>

	
	<h3>Rejected Terms</h3>	
	<%if !@removed_by_calais.blank?%>
		<h4>Open Calais</h4>
		<ul>
		<%for calais in @removed_by_calais%>
			<li><%=calais.phrase.words%></li>
		<%end%>
		</ul>
    <%end%>

	<%if !@too_short.blank?%>
		<h4>Too Short</h4>
		<ul>
		<%for item in @too_short%>
			<li><%=item.phrase.words%></li>
		<%end%>
		</ul>
    <%end%>

	<%if !@no_matches.blank?%>
		<h4>No Geo Matches</h4>
		<ul>
		<%for item in @no_matches%>
			<li><%=item.phrase.words%></li>
		<%end%>
		</ul>
    <%end%>

	<%if !@stopped.blank?%>
		<h4>Stopped</h4>
		<ul>
		<%for item in @stopped%>
			<li><%=item.phrase.words%></li>
		<%end%>
		</ul>
    <%end%>

	<%if !@geoparser_failed.blank?%>
		<h4>Geoparser Failed</h4>
		<ul>
		<%for item in @geoparser_failed%>
			<li><%=item.phrase.words%></li>
		<%end%>
		</ul>
    <%end%>



	

	
	
	</div>
<%end%>	

